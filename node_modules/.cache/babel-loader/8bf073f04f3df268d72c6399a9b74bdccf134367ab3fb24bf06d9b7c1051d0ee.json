{"ast":null,"code":"import _objectSpread from\"/Users/amirkia/Documents/active-front/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import useGetProductVariants from'./hooks/useGetProductVariants';import CardItem from'components/cards/product';import Header from'components/headers/main';import Loading from'components/loading';import Footer from'./footer';import useSetCardItems from'./hooks/useSetCardItems';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function ProductVariantsPage(){const[cards,setCards]=useState();const[selectedCards,setSelectedCards]=useState([]);const{data,isLoading}=useGetProductVariants();const{mutate,isPending}=useSetCardItems(setCards);const[lastOfData,setLastOfData]=useState();useEffect(()=>{if(data){setCards(data);const newSelected=[];data.items.map(item=>newSelected.push(_objectSpread(_objectSpread({},item),{},{variants:[]})));setSelectedCards(newSelected);}},[data]);const handleMutate=(base_uuid,payload,count)=>{const newSelctedCard=[];selectedCards.map(item=>{if(item.base_uuid===base_uuid){const findVariant=item.variants.find(v=>v.variant_uuid===payload.variant_uuid);if(findVariant){const filterVariants=item.variants.filter(v=>v.variant_uuid!==payload.variant_uuid);newSelctedCard.push(_objectSpread(_objectSpread({},item),{},{variants:[...filterVariants,_objectSpread(_objectSpread({},payload),{},{quantity:count})]}));}else{newSelctedCard.push(_objectSpread(_objectSpread({},item),{},{variants:[...item.variants,_objectSpread(_objectSpread({},payload),{},{quantity:count})]}));}}else{newSelctedCard.push(item);}});setSelectedCards(newSelctedCard);if(cards){const newData={total_duration:cards===null||cards===void 0?void 0:cards.total_duration,total_price:cards.total_price,items:newSelctedCard};setLastOfData(newData);mutate(newData);}};const handleNewVariantMutate=(base_uuid,payload,squareCount)=>{const newSelctedCard=[];selectedCards.map(item=>{if(item.base_uuid===base_uuid){console.log('item.new_variants',item);if(item.new_variants){newSelctedCard.push(_objectSpread(_objectSpread({},item),{},{new_variants:[...item.new_variants,{variant_quantity:squareCount,quantity:payload}]}));}else{newSelctedCard.push(_objectSpread(_objectSpread({},item),{},{new_variants:[{variant_quantity:squareCount,quantity:payload}]}));}}else{newSelctedCard.push(item);}});setSelectedCards(newSelctedCard);if(cards){const newData={total_duration:cards===null||cards===void 0?void 0:cards.total_duration,total_price:cards.total_price,items:newSelctedCard};setLastOfData(newData);mutate(newData);}};return/*#__PURE__*/_jsx(_Fragment,{children:isLoading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-full min-h-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-none w-full\",children:/*#__PURE__*/_jsx(Header,{title:\"\\u062E\\u062F\\u0645\\u062A \\u062F\\u0631 \\u0645\\u062D\\u0644\"})}),/*#__PURE__*/_jsx(\"div\",{className:\" grow\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-4 items-center justify-center my-2 mx-2\",children:cards&&cards.items.map(item=>/*#__PURE__*/_jsx(CardItem,{item:item,handleMutate:handleMutate,handleNewVariantMutate:handleNewVariantMutate},item.base_uuid))})}),cards&&cards.total_duration&&cards.total_price&&/*#__PURE__*/_jsx(\"div\",{className:\"flex-none\",children:/*#__PURE__*/_jsx(Footer,{time:cards.total_duration,price:cards.total_price,data:lastOfData,mutate:mutate})})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}